<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>MiR Cargo Nicaragua</title>

  <style>
    :root{
      --azulRoyal:#1f4fae;
      --azulNavy:#1b3a6b;
      --azulDeep:#0f2a55;

      --celesteTxt:#2ea8ff;
      --celesteBg:rgba(46,168,255,.14);

      --bg:#f6f7fb;
      --card:#ffffff;
      --border:rgba(15,23,42,.10);
      --text:#0f172a;
      --muted:#64748b;

      --accent:#ffd1a6;
      --accentH:#ffbf85;

      --wa:#25D366;
      --waH:#1ebe5d;

      --shadowSoft: 0 10px 26px rgba(2, 6, 23, .07);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 500px at 40% 0%, rgba(31,79,174,.10), transparent 60%),
        radial-gradient(800px 400px at 75% 10%, rgba(255,209,166,.20), transparent 60%),
        var(--bg);
    }

    header{
      position:sticky;
      top:0;
      z-index:50;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      background: rgba(255,255,255,.70);
      border-bottom: 1px solid rgba(15,23,42,.08);
    }

    .topbar{
      max-width:1100px;
      margin:0 auto;
      padding:14px 14px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .brand{
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      line-height:1.1;
      min-width: 220px;
    }
    .brand .title{
      font-weight:900;
      letter-spacing:.6px;
      font-size:15px;
      text-transform:uppercase;
    }
    .brand .subtitle{
      font-size:12.5px;
      color:var(--muted);
      margin-top:4px;
    }

    .flags{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .flag{
      width:44px;
      height:28px;
      border-radius:8px;
      object-fit:cover;
      box-shadow: 0 8px 18px rgba(2,6,23,.12);
      border:1px solid rgba(15,23,42,.10);
      background:#fff;
    }

    .tabs{
      max-width:1100px;
      margin:0 auto;
      padding:0 14px 14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:center;
    }

    .tab{
      border:none;
      cursor:pointer;
      border-radius:999px;
      padding:12px 16px;
      font-weight:900;
      letter-spacing:.4px;
      text-transform:uppercase;
      font-size:14px;
      color:var(--azulDeep);
      background: rgba(31,79,174,.08);
      border: 1px solid rgba(31,79,174,.18);
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition: transform .08s ease, background .15s ease, box-shadow .15s ease;
    }
    .tab:hover{ background: rgba(31,79,174,.12); transform: translateY(-1px); }
    .tab.active{
      background: linear-gradient(90deg, rgba(31,79,174,.95), rgba(27,58,107,.95));
      color:#fff;
      border-color: rgba(0,0,0,.06);
      box-shadow: 0 10px 22px rgba(31,79,174,.20);
    }

    main{
      max-width:1100px;
      margin:0 auto;
      padding:18px 14px 34px;
    }

    /* HERO (DIN√ÅMICO) */
    .hero{
      border-radius: 22px;
      background:
        radial-gradient(900px 360px at 10% 0%, rgba(31,79,174,.20), transparent 60%),
        radial-gradient(900px 360px at 90% 0%, rgba(255,209,166,.40), transparent 55%),
        rgba(255,255,255,.65);
      border: 1px solid rgba(15,23,42,.08);
      box-shadow: var(--shadowSoft);
      padding:22px;
      display:flex;
      justify-content:space-between;
      gap:14px;
      align-items:center;
    }

    .hero h1{
      margin:0;
      font-size:34px;
      letter-spacing:-.4px;
      line-height:1.06;
    }
    .hero p{
      margin:10px 0 0;
      color:var(--muted);
      font-size:14.5px;
      line-height:1.35;
      max-width: 760px;
      white-space: pre-line;
    }

    .heroIconWrap{
      min-width: 72px;
      display:flex;
      justify-content:flex-end;
      align-items:center;
    }
    .heroIcon{
      width:58px;
      height:58px;
      border-radius: 18px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(31,79,174,.10);
      border: 1px solid rgba(31,79,174,.18);
      box-shadow: 0 14px 26px rgba(31,79,174,.10);
    }
    .heroIcon svg{ width:30px; height:30px; }
    .heroEmoji{ font-size:26px; font-weight:900; }

    .section{ margin-top:18px; display:none; }
    .section.active{ display:block; }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadowSoft);
      overflow:hidden;
      margin-top:16px;
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      padding:14px 16px;
      border-bottom:1px solid rgba(15,23,42,.08);
    }
    .row:last-child{ border-bottom:none; }

    .input{
      flex:1;
      min-width: 240px;
      border: 1px solid rgba(15,23,42,.12);
      background:#fff;
      border-radius: 14px;
      padding:12px 14px;
      font-size:15px;
      outline:none;
    }

    .btn{
      border:none;
      border-radius: 14px;
      padding:12px 16px;
      font-weight:900;
      cursor:pointer;
      background: var(--accent);
      color: var(--text);
      transition: background .15s ease, transform .08s ease;
      white-space:nowrap;
    }
    .btn:hover{ background: var(--accentH); transform: translateY(-1px); }
    .btn.secondary{
      background: rgba(31,79,174,.08);
      border:1px solid rgba(31,79,174,.18);
      color: var(--azulDeep);
    }
    .btn.secondary:hover{ background: rgba(31,79,174,.12); }

    .results{ padding:8px 16px 14px; }
    .empty{ display:none; padding:14px 16px; color:var(--muted); font-weight:800; text-align:center; }

    .result-block{
      border: 1px solid rgba(15,23,42,.10);
      border-radius: 16px;
      padding:12px 14px;
      margin-top:10px;
      background: #fff;
      box-shadow: 0 10px 20px rgba(2,6,23,.05);
    }
    .result-block p{ margin:6px 0; line-height:1.25; word-break: break-word; font-size:14px; }

    .status-pill{
      display:inline-block;
      padding:4px 10px;
      border-radius: 999px;
      font-weight:900;
      font-size:12.5px;
      background: var(--celesteBg);
      color: var(--celesteTxt);
      border:1px solid rgba(46,168,255,.22);
    }

    .detail-actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .view-btn{
      border:none;
      border-radius: 14px;
      padding:11px 14px;
      font-weight:900;
      cursor:pointer;
      background: rgba(31,79,174,.92);
      color:#fff;
      transition: transform .08s ease, filter .15s ease;
    }
    .view-btn:hover{ transform: translateY(-1px); filter: brightness(1.06); }

    /* CONTACTO */
    .contactGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      padding:16px;
    }
    @media(min-width:740px){ .contactGrid{ grid-template-columns: 1.2fr 1.2fr 1fr; } }

    .contactCard{
      background: #fff;
      border:1px solid rgba(15,23,42,.10);
      border-radius: 18px;
      padding:14px;
      box-shadow: 0 12px 26px rgba(2,6,23,.06);
    }
    .contactCard .city{ font-weight:1000; font-size:14px; margin-bottom:8px; }
    .contactCard .line{ color: var(--muted); font-size:13.5px; line-height:1.35; margin:5px 0; }

    .contactActions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .contactBtn{
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:11px 14px;
      border-radius: 14px;
      font-weight:900;
      border:1px solid rgba(15,23,42,.10);
      background: rgba(2,6,23,.02);
      color: var(--text);
    }
    .contactBtn.call{ background: var(--accent); border-color: rgba(0,0,0,.08); }
    .contactBtn.map{ background: rgba(31,79,174,.08); border-color: rgba(31,79,174,.18); color: var(--azulDeep); }
    .contactBtn.wa{ background: var(--wa); border-color: rgba(0,0,0,.10); color:#fff; }
    .contactBtn.wa:hover{ background: var(--waH); }

    /* COTIZACI√ìN */
    .calcWrap{ padding:16px; }

    .q{ font-weight:1000; font-size:14px; }
    .desc{ color:var(--muted); font-size:13.5px; line-height:1.35; }

    .choiceRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .choice{
      flex:1;
      min-width:220px;
      border:1px solid rgba(15,23,42,.10);
      background:#fff;
      border-radius: 16px;
      padding:12px 14px;
      font-weight:1000;
      cursor:pointer;
      display:flex;
      justify-content:center;
      gap:8px;
      align-items:center;
      transition: transform .08s ease, border-color .15s ease, background .15s ease;
    }
    .choice:hover{ transform: translateY(-1px); border-color: rgba(31,79,174,.25); }
    .choice.active{
      background: linear-gradient(90deg, rgba(31,79,174,.95), rgba(27,58,107,.95));
      color:#fff;
      border-color: rgba(0,0,0,.06);
    }

    #calcStep2{
      display:none;
      margin-top:14px;
      padding-top:14px;
      border-top:1px solid rgba(15,23,42,.10);
    }
    #calcStep2.active{ display:block; }

    .subTabs{ display:flex; gap:10px; flex-wrap:wrap; margin:10px 0 10px; }
    .subTab{
      flex:1;
      min-width:220px;
      border:1px solid rgba(15,23,42,.10);
      background:#fff;
      border-radius: 16px;
      padding:12px 14px;
      font-weight:1000;
      cursor:pointer;
      display:flex;
      justify-content:center;
      gap:8px;
      align-items:center;
    }
    .subTab.active{ background: rgba(46,168,255,.12); border-color: rgba(46,168,255,.30); }

    .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px; }
    @media(max-width:720px){ .grid{ grid-template-columns:1fr; } }

    .label{ font-size:13px; color: var(--muted); font-weight:900; margin:0 0 6px; }
    .select, .field{
      width:100%;
      border:1px solid rgba(15,23,42,.12);
      background:#fff;
      border-radius: 14px;
      padding:12px 14px;
      font-size:14.5px;
      outline:none;
    }

    .actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    .result{
      margin-top:12px;
      border-radius: 16px;
      padding:12px 14px;
      background: rgba(46,168,255,.10);
      border:1px solid rgba(46,168,255,.22);
      font-weight:900;
      min-height: 44px;
      line-height:1.35;
    }
    .result b{ color: var(--azulDeep); }

    .note{
      margin-top:10px;
      border-radius: 16px;
      padding:12px 14px;
      background: rgba(255,209,166,.28);
      border: 1px solid rgba(255,191,133,.55);
      color: rgba(15,23,42,.78);
      font-size:12.8px;
      line-height:1.35;
      font-weight:700;
    }

    /* AGENDA */
    .schedule{ padding:16px; display:grid; gap:12px; }
    .schedule p{ margin:0; color: var(--muted); line-height:1.45; font-size:14px; }
    .bigBtn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      text-decoration:none;
      border-radius: 18px;
      padding:14px 16px;
      font-weight:1000;
      background: var(--wa);
      color:#fff;
      border:1px solid rgba(0,0,0,.10);
      width: fit-content;
      box-shadow: 0 16px 30px rgba(37,211,102,.20);
    }
    .bigBtn:hover{ background: var(--waH); }

    @media(max-width:560px){
      .hero h1{ font-size:28px; }
      .tab{ padding:12px 14px; font-size:13.5px; }
      .flag{ width:40px; height:26px; }
      .heroIcon{ width:54px; height:54px; border-radius:16px; }
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>

<body>

<header>
  <div class="topbar">
    <div class="brand">
      <div class="title">MIR CARGO NICARAGUA</div>
      <div class="subtitle">Rastreo ‚Ä¢ Contacto ‚Ä¢ Cotizaci√≥n ‚Ä¢ Agendar</div>
    </div>
    <div class="flags">
      <img class="flag" src="https://flagcdn.com/us.svg" alt="Usa" />
      <img class="flag" src="https://flagcdn.com/ni.svg" alt="Nicaragua" />
    </div>
  </div>

  <div class="tabs" role="tablist" aria-label="Secciones">
    <button class="tab active" id="tabTrack" type="button">üì¶ Rastreo</button>
    <button class="tab" id="tabContact" type="button">üìç Contacto</button>
    <button class="tab" id="tabCalc" type="button">üñ© Cotizar Env√≠o</button>
    <button class="tab" id="tabSchedule" type="button">üóìÔ∏è Agendar</button>
  </div>
</header>

<main>
  <!-- HERO DIN√ÅMICO (√öNICO T√çTULO, SIN REPETICI√ìN) -->
  <div class="hero" id="hero">
    <div>
      <h1 id="heroTitle">Rastre√° tus env√≠os y/o compras en l√≠nea</h1>
      <p id="heroText">Busc√° por tracking o nombre</p>
    </div>
    <div class="heroIconWrap">
      <div class="heroIcon" id="heroIcon" aria-hidden="true">
        <span class="heroEmoji">üì¶</span>
      </div>
    </div>
  </div>

  <!-- RASTREO -->
  <section class="section active" id="secTrack">
    <div class="card">
      <div class="row">
        <div style="min-width:160px; font-weight:1000;">üö¢ Rastreo Mar√≠timo</div>
        <input class="input" id="searchMaritimo" placeholder="N√∫mero de rastreo mar√≠timo" />
        <button class="btn" type="button" onclick="searchTracking('Maritimo')">Buscar</button>
      </div>
      <div class="results" id="resultsMaritimo"></div>
      <div class="empty" id="emptyMaritimo">No encontramos ese n√∫mero.</div>

      <div class="row">
        <div style="min-width:160px; font-weight:1000;">‚úàÔ∏è Rastreo A√©reo</div>
        <input class="input" id="searchAereo" placeholder="N√∫mero de rastreo a√©reo" />
        <button class="btn" type="button" onclick="searchTracking('Aereo')">Buscar</button>
      </div>
      <div class="results" id="resultsAereo"></div>
      <div class="empty" id="emptyAereo">No encontramos ese n√∫mero.</div>

      <div class="row">
        <div style="min-width:160px; font-weight:1000;">üõçÔ∏è Compras En L√≠nea</div>
        <input class="input" id="searchCompra" placeholder="Nombre o n√∫mero de tracking" />
        <button class="btn" type="button" onclick="searchTracking('Compra')">Buscar</button>
      </div>
      <div class="results" id="resultsCompra"></div>
      <div class="empty" id="emptyCompra">Sin resultados.</div>
    </div>
  </section>

  <!-- CONTACTO -->
  <section class="section" id="secContact">
    <div class="card">
      <div class="contactGrid">
        <div class="contactCard">
          <div class="city">üìç Miami</div>
          <div class="line">2035 W Flagler St, Miami, FL 33135.</div>
          <div class="line"><b>Tel:</b> 305-631-0701 / 786-853-4444.</div>
          <div class="contactActions">
            <a class="contactBtn call" href="tel:+13056310701">üìû Llamar</a>
            <a class="contactBtn wa" target="_blank" rel="noopener"
              href="https://wa.me/13056310701?text=Hola%2C%20quiero%20que%20recojan%20una%20carga%20en%20la%20direcci%C3%B3n%3A%20___________.%20Mi%20nombre%20es%3A%20__________.%20Y%20mi%20tel%C3%A9fono%20es%3A%20________.">üí¨ WhatsApp</a>
            <a class="contactBtn map" target="_blank" rel="noopener"
              href="https://www.google.com/maps/search/?api=1&query=2035%20W%20Flagler%20St%20Miami%20FL%2033135">üìç Maps</a>
          </div>
        </div>

        <div class="contactCard">
          <div class="city">üìç Managua</div>
          <div class="line">Comtech Altamira, 1c arriba, 2c lago, 1c abajo. Casa #698.</div>
          <div class="line"><b>Tel:</b> 8785-3842 / 8781-2066.</div>
          <div class="contactActions">
            <a class="contactBtn call" href="tel:+50587853842">üìû Llamar</a>
            <a class="contactBtn map" target="_blank" rel="noopener" href="https://maps.app.goo.gl/adbe3fBPA6vcGd8t5">üìç Maps</a>
          </div>
        </div>

        <div class="contactCard">
          <div class="city">üìç Chinandega</div>
          <div class="line">Esquina Suroeste de la Escuela El Rosario.</div>
          <div class="line"><b>Tel:</b> 2346-8244 / 8899-9548.</div>
          <div class="contactActions">
            <a class="contactBtn call" href="tel:+50523468244">üìû Llamar</a>
            <a class="contactBtn map" target="_blank" rel="noopener" href="https://maps.app.goo.gl/PVczh5oMTN3kp53R6">üìç Maps</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- COTIZACI√ìN (SIN T√çTULOS REPETIDOS ADENTRO) -->
  <section class="section" id="secCalc">
    <div class="card">
      <div class="calcWrap">
        <div class="q">¬øQu√© tipo de env√≠o quer√©s cotizar?</div>
        <div class="desc">Eleg√≠ una opci√≥n para continuar.</div>

        <div class="choiceRow">
          <button class="choice" type="button" id="chooseMar">üö¢ Mar√≠timo</button>
          <button class="choice" type="button" id="chooseAir">‚úàÔ∏è A√©reo</button>
        </div>

        <div id="calcStep2">
          <div class="q" style="margin-bottom:6px;" id="step2Title">Continu√° con tu cotizaci√≥n</div>

          <!-- MAR√çTIMO -->
          <div id="marBox" style="display:none;">
            <div class="q" style="margin-bottom:6px;">¬øC√≥mo quer√©s cotizar?</div>

            <!-- ‚úÖ ORDEN CAMBIADO: VOLUMEN PRIMERO -->
            <div class="subTabs">
              <button class="subTab active" type="button" id="marVolTab">üì¶ Por volumen</button>
              <button class="subTab" type="button" id="marPesoTab">‚öñÔ∏è Por peso</button>
            </div>

            <!-- ‚úÖ DEFAULT: VOLUMEN VISIBLE -->
            <div id="marVolPanel">
              <div class="grid">
                <div>
                  <div class="label">Tipo de art√≠culo</div>
                  <select class="select" id="calcItemType">
                    <option value="mueble_10">Mueble</option>
                    <option value="ropa_30">Caja con ropa y art√≠culos varios</option>
                    <option value="refri_12">Electrodom√©stico (Refrigeradora)</option>
                    <option value="lavadora_20">Electrodom√©stico (Lavadora / Secadora / Cocina)</option>
                  </select>
                </div>

                <div>
                  <div class="label">Largo (In)</div>
                  <input class="field" type="number" id="calcL" placeholder="L" min="0" step="0.1" inputmode="decimal" />
                </div>

                <div>
                  <div class="label">Ancho (In)</div>
                  <input class="field" type="number" id="calcW" placeholder="W" min="0" step="0.1" inputmode="decimal" />
                </div>

                <div>
                  <div class="label">Alto (In)</div>
                  <input class="field" type="number" id="calcH" placeholder="H" min="0" step="0.1" inputmode="decimal" />
                </div>
              </div>

              <div class="actions">
                <button class="btn" type="button" id="calcBtnMarVol">Cotizar</button>
                <button class="btn secondary" type="button" id="calcBtnMarVolClear">Limpiar</button>
              </div>

              <div class="result" id="calcResV"></div>

              <div class="note">
                El precio puede variar si las cantidades no est√°n correctas, el art√≠culo no est√° empacado,
                o si el peso es demasiado para el art√≠culo.
              </div>
            </div>

            <div id="marPesoPanel" style="display:none;">
              <div class="grid">
                <div>
                  <div class="label">Libras (Lbs)</div>
                  <input class="field" type="number" id="calcMarLbs" placeholder="Ej: 120" min="0" step="0.1" inputmode="decimal" />
                </div>
              </div>

              <div class="actions">
                <button class="btn" type="button" id="calcBtnMarPeso">Cotizar</button>
                <button class="btn secondary" type="button" id="calcBtnMarPesoClear">Limpiar</button>
              </div>

              <div class="result" id="calcResM"></div>

              <div class="note">
                Reglas por libra:
                <br>‚Ä¢ Hasta 100 Lbs: <b>$2.05/Lb</b>
                <br>‚Ä¢ M√°s de 100 Lbs: <b>$2.00/Lb</b>
                <br>‚Ä¢ M√°s de 300 Lbs: <b>$1.90/Lb</b>
                <br>‚Ä¢ M√°s de 500 Lbs: <b>$1.80/Lb</b>
              </div>
            </div>
          </div>

          <!-- A√âREO -->
          <div id="airBox" style="display:none;">
            <div class="q" style="margin-bottom:6px;">Ingres√° el peso para cotizar</div>

            <div class="grid">
              <div>
                <div class="label">Libras (Lbs)</div>
                <input class="field" type="number" id="calcAereoLbs" placeholder="Ej: 15" min="0" step="0.1" inputmode="decimal" />
              </div>
            </div>

            <div class="actions">
              <button class="btn" type="button" id="calcBtnAereo">Cotizar</button>
              <button class="btn secondary" type="button" id="calcBtnAereoClear">Limpiar</button>
            </div>

            <div class="result" id="calcResA"></div>

            <div class="note">
              Regla: Hasta 20 Lbs se cobra a <b>$7.00/Lb</b>. Si es <b>m√°s de 20 Lbs</b>, se cobra a <b>$6.50/Lb</b>.
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- AGENDAR -->
  <section class="section" id="secSchedule">
    <div class="card">
      <div class="schedule">
        <p>
          Para agendar, escribinos por WhatsApp. Te dejamos un mensaje listo para que solo complet√©s la direcci√≥n,
          tu nombre y tu tel√©fono.
        </p>

        <a class="bigBtn" target="_blank" rel="noopener"
          href="https://wa.me/13056310701?text=Hola%2C%20quiero%20que%20recojan%20una%20carga%20en%20la%20direcci%C3%B3n%3A%20___________.%20Mi%20nombre%20es%3A%20__________.%20Y%20mi%20tel%C3%A9fono%20es%3A%20________.">
          üí¨ Escribir Por WhatsApp (Miami)
        </a>

        <p style="font-size:12.8px;">Si prefer√≠s, tambi√©n pod√©s llamar al <b>305-631-0701</b>.</p>
      </div>
    </div>
  </section>
</main>

<script>
/* ========================= Rastreo ========================= */
const urls = {
  Maritimo:[
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vT2i-JMsQ4G2mXMfdEyihWcNeI8gzXDIWsSxOta60eGa-NgNDOshNojOB6mYxdHPOWkLKwGWZsdnfIL/pub?gid=0&single=true&output=csv",
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vT2i-JMsQ4G2mXMfdEyihWcNeI8gzXDIWsSxOta60eGa-NgNDOshNojOB6mYxdHPOWkLKwGWZsdnfIL/pub?gid=135469883&single=true&output=csv"
  ],
  Aereo:[
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vT2i-JMsQ4G2mXMfdEyihWcNeI8gzXDIWsSxOta60eGa-NgNDOshNojOB6mYxdHPOWkLKwGWZsdnfIL/pub?gid=1149417296&single=true&output=csv",
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vT2i-JMsQ4G2mXMfdEyihWcNeI8gzXDIWsSxOta60eGa-NgNDOshNojOB6mYxdHPOWkLKwGWZsdnfIL/pub?gid=1429832468&single=true&output=csv"
  ],
  Compra:
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vT2i-JMsQ4G2mXMfdEyihWcNeI8gzXDIWsSxOta60eGa-NgNDOshNojOB6mYxdHPOWkLKwGWZsdnfIL/pub?gid=532919355&single=true&output=csv"
};

function normalizeImageUrl(url){
  if(!url) return "";
  url = (url + "").trim();
  let m = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
  if(m) return `https://drive.google.com/uc?export=view&id=${m[1]}`;
  m = url.match(/[?&]id=([a-zA-Z0-9_-]+)/);
  if(m) return `https://drive.google.com/uc?export=view&id=${m[1]}`;
  if(url.includes("googleusercontent")) return url;
  return url;
}
function safe(r,keys){ for(const k of keys){ if(r && r[k]) return r[k]; } return ""; }

function parseDate(dateString){
  if(!dateString) return 0;
  const [datePart, timePart] = (dateString + "").split(" ");
  if(!datePart || !timePart) return 0;
  const [day, month, year] = datePart.split("/");
  const [hour, minute, second] = timePart.split(":");
  return new Date(parseInt(year,10), parseInt(month,10)-1, parseInt(day,10), parseInt(hour,10), parseInt(minute,10), parseInt(second,10)).getTime();
}

/* ‚úÖ NUEVO: Fecha bonita con mes en nombre + AM/PM */
function formatFechaBonita(dateString){
  if(!dateString) return "";
  const raw = (dateString + "").trim();

  // Espera: DD/MM/YYYY HH:MM:SS
  const [datePart, timePart] = raw.split(" ");
  if(!datePart || !timePart) return raw;

  const [day, month, year] = datePart.split("/");
  let [hh, mm, ss] = timePart.split(":");

  const meses = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
  const d = parseInt(day,10);
  const m = parseInt(month,10);
  const y = year;

  let hour24 = parseInt(hh,10);
  const ampm = hour24 >= 12 ? "PM" : "AM";
  let hour12 = hour24 % 12;
  if(hour12 === 0) hour12 = 12;

  const mesNombre = meses[m-1] || month;
  const min2 = String(mm).padStart(2,"0");
  const sec2 = String(ss || "00").padStart(2,"0");

  return `${d} de ${mesNombre}, ${y} ${hour12}:${min2}:${sec2} ${ampm}`;
}

function renderTable(list,type){
  const container = document.getElementById(`results${type}`);
  const empty = document.getElementById(`empty${type}`);
  container.innerHTML = "";
  empty.style.display = "none";
  if(!list.length){ empty.style.display="block"; return; }

  list.sort((a,b)=>parseDate(safe(b,["Fecha","FECHA"])) - parseDate(safe(a,["Fecha","FECHA"])));
  if(type === "Compra") list = list.slice(0,40);

  list.forEach(r=>{
    const fechaRaw = safe(r,["Fecha","FECHA"]);
    const fecha = formatFechaBonita(fechaRaw);

    const track = safe(r,["Tracking","Tracking #","Orden","ORDEN"]);
    const nombre = safe(r,["Nombre","Cliente","CLIENTE"]);
    const status = safe(r,["Status","STATUS"]);
    const agente = safe(r,["Agente","AGENTE","Usuario"]);
    const foto  = normalizeImageUrl(safe(r,["Web url","Web URL"]));
    const firma = normalizeImageUrl(safe(r,["Firma url","Firma URL"]));

    let html = `<div class="result-block">`;
    html += `<p><strong>Fecha:</strong> ${fecha}</p>`;
    html += `<p><strong>Tracking:</strong> ${track}</p>`;
    if(type === "Compra"){
      html += `<p><strong>Nombre:</strong> ${nombre}</p>`;
      html += `<p><strong>Agente:</strong> ${agente}</p>`;
    } else {
      html += `<p><strong>Status:</strong> <span class="status-pill">${status}</span></p>`;
      html += `<p><strong>Agente:</strong> ${agente}</p>`;
    }
    html += `<div class="detail-actions">`;
    if(foto)  html += `<button class="view-btn" type="button" onclick="window.open('${foto}','_blank')">üì∑ Ver foto</button>`;
    if(type !== "Compra" && firma) html += `<button class="view-btn" type="button" onclick="window.open('${firma}','_blank')">‚úçÔ∏è Ver firma</button>`;
    html += `</div></div>`;
    container.insertAdjacentHTML("beforeend", html);
  });
}

async function searchTracking(type){
  const input = document.getElementById(`search${type}`);
  const code = (input.value || "").trim().toLowerCase();
  if(!code) return;

  let data = [];
  const links = Array.isArray(urls[type]) ? urls[type] : [urls[type]];
  for(const link of links){
    await new Promise(resolve=>{
      Papa.parse(link + "&t=" + Date.now(),{
        download:true, header:true, skipEmptyLines:true,
        complete:res=>{ data = data.concat(res.data || []); resolve(); }
      });
    });
  }

  const filtered = data.filter(r=>{
    const track = safe(r,["Tracking","Tracking #","Orden","ORDEN"]).toLowerCase();
    const name  = safe(r,["Nombre","Cliente"]).toLowerCase();
    return track.includes(code) || name.includes(code);
  });

  renderTable(filtered, type);
}

["Maritimo","Aereo","Compra"].forEach(t=>{
  document.getElementById(`search${t}`).addEventListener("keydown", e=>{
    if(e.key === "Enter") searchTracking(t);
  });
});

/* ========================= HERO DIN√ÅMICO + Tabs ========================= */
(function(){
  const heroTitle = document.getElementById("heroTitle");
  const heroText  = document.getElementById("heroText");
  const heroIcon  = document.getElementById("heroIcon");

  const calcSvg = `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M7.5 3.75h9A2.25 2.25 0 0 1 18.75 6v12A2.25 2.25 0 0 1 16.5 20.25h-9A2.25 2.25 0 0 1 5.25 18V6A2.25 2.25 0 0 1 7.5 3.75Z" stroke="rgba(15,42,85,.95)" stroke-width="1.6"/>
      <path d="M7.5 7.5h9" stroke="rgba(15,42,85,.95)" stroke-width="1.6" stroke-linecap="round"/>
      <path d="M8.3 11.2h2.1M13.6 11.2h2.1M8.3 14.2h2.1M13.6 14.2h2.1M8.3 17.2h2.1M13.6 17.2h2.1"
            stroke="rgba(15,42,85,.95)" stroke-width="1.6" stroke-linecap="round"/>
    </svg>
  `;

  const tabConfig = {
    tabTrack: {
      title:"Rastre√° tus env√≠os y/o compras en l√≠nea",
      text:"Busc√° por tracking o nombre",
      iconHtml:`<span class="heroEmoji">üì¶</span>`
    },
    tabContact: {
      title:"Contacto",
      text:"Direcciones y tel√©fonos",
      iconHtml:`<span class="heroEmoji">üìç</span>`
    },
    tabCalc: {
      title:"Cotiz√° el costo de tu env√≠o",
      text:"Seleccion√° el tipo de env√≠o y met√© libras o medidas para estimar el total.",
      iconHtml: calcSvg
    },
    tabSchedule: {
      title:"Agend√° la recolecci√≥n de tu carga con nosotros",
      text:"",
      iconHtml:`<span class="heroEmoji">üóìÔ∏è</span>`
    }
  };

  const tabs = [
    { btn:"tabTrack", sec:"secTrack" },
    { btn:"tabContact", sec:"secContact" },
    { btn:"tabCalc", sec:"secCalc" },
    { btn:"tabSchedule", sec:"secSchedule" }
  ];

  function setHero(btnId){
    const cfg = tabConfig[btnId];
    if(!cfg) return;
    heroTitle.textContent = cfg.title;
    heroText.textContent  = cfg.text || "";
    heroIcon.innerHTML    = cfg.iconHtml || `<span class="heroEmoji">üì¶</span>`;
  }

  function openTab(btnId){
    tabs.forEach(t=>{
      document.getElementById(t.btn).classList.toggle("active", t.btn === btnId);
      document.getElementById(t.sec).classList.toggle("active", t.btn === btnId);
    });
    setHero(btnId);
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  tabs.forEach(t=>document.getElementById(t.btn).addEventListener("click", ()=>openTab(t.btn)));

  // default
  setHero("tabTrack");
})();

/* ========================= Cotizaci√≥n (Scroll Down Real) ========================= */
document.addEventListener("DOMContentLoaded", ()=>{
  const chooseMar = document.getElementById("chooseMar");
  const chooseAir = document.getElementById("chooseAir");

  const step2 = document.getElementById("calcStep2");
  const step2Title = document.getElementById("step2Title");

  const marBox = document.getElementById("marBox");
  const airBox = document.getElementById("airBox");

  const marPesoTab = document.getElementById("marPesoTab");
  const marVolTab  = document.getElementById("marVolTab");
  const marPesoPanel = document.getElementById("marPesoPanel");
  const marVolPanel  = document.getElementById("marVolPanel");

  const money = (n) => (Number.isFinite(n) ? n.toFixed(2) : "0.00");
  const num = (id) => {
    const v = parseFloat(document.getElementById(id).value);
    return Number.isFinite(v) ? v : 0;
  };

  function showStep2AndScroll(){
    step2.classList.add("active");
    const y = step2.getBoundingClientRect().top + window.scrollY - 90;
    window.scrollTo({ top: y, behavior: "smooth" });
  }

  function setShip(which){
    const isMar = which === "mar";
    chooseMar.classList.toggle("active", isMar);
    chooseAir.classList.toggle("active", !isMar);

    marBox.style.display = isMar ? "block" : "none";
    airBox.style.display = isMar ? "none" : "block";

    step2Title.textContent = isMar
      ? "Elegiste Mar√≠timo. Ahora seleccion√° volumen o peso"
      : "Elegiste A√©reo. Ahora ingres√° el peso";

    showStep2AndScroll();
  }

  chooseMar.addEventListener("click", ()=>setShip("mar"));
  chooseAir.addEventListener("click", ()=>setShip("air"));

  function setMarMode(which){
    const isVol = which === "vol";
    marVolTab.classList.toggle("active", isVol);
    marPesoTab.classList.toggle("active", !isVol);
    marVolPanel.style.display  = isVol ? "block" : "none";
    marPesoPanel.style.display = isVol ? "none"  : "block";
  }
  marVolTab.addEventListener("click", ()=>setMarMode("vol"));
  marPesoTab.addEventListener("click", ()=>setMarMode("peso"));

  // A√©reo
  document.getElementById("calcBtnAereo").addEventListener("click", ()=>{
    const lbs = num("calcAereoLbs");
    const out = document.getElementById("calcResA");
    if(lbs <= 0){ out.textContent = "Ingres√° un peso v√°lido."; return; }
    const rate = (lbs > 20) ? 6.5 : 7;
    out.innerHTML = `Total aproximado: <b>$${money(lbs * rate)}</b>`;
  });
  document.getElementById("calcBtnAereoClear").addEventListener("click", ()=>{
    document.getElementById("calcAereoLbs").value = "";
    document.getElementById("calcResA").textContent = "";
  });

  // Mar√≠timo por peso
  function rateMar(lbs){
    if(lbs > 500) return 1.8;
    if(lbs > 300) return 1.9;
    if(lbs > 100) return 2.0;
    return 2.05;
  }
  document.getElementById("calcBtnMarPeso").addEventListener("click", ()=>{
    const lbs = num("calcMarLbs");
    const out = document.getElementById("calcResM");
    if(lbs <= 0){ out.textContent = "Ingres√° un peso v√°lido."; return; }
    out.innerHTML = `Total aproximado: <b>$${money(lbs * rateMar(lbs))}</b>`;
  });
  document.getElementById("calcBtnMarPesoClear").addEventListener("click", ()=>{
    document.getElementById("calcMarLbs").value = "";
    document.getElementById("calcResM").textContent = "";
  });

  // Mar√≠timo por volumen
  function getMultiplier(){
    const v = (document.getElementById("calcItemType").value || "");
    if(v === "mueble_10") return { mult: 10, label: "Mueble" };
    if(v === "ropa_30") return { mult: 30, label: "Caja con ropa y art√≠culos varios" };
    if(v === "refri_12") return { mult: 12, label: "Electrodom√©stico (Refrigeradora)" };
    if(v === "lavadora_20") return { mult: 20, label: "Electrodom√©stico (Lavadora / Secadora / Cocina)" };
    return { mult: 10, label: "Mueble" };
  }

  document.getElementById("calcBtnMarVol").addEventListener("click", ()=>{
    const L = num("calcL"), W = num("calcW"), H = num("calcH");
    const out = document.getElementById("calcResV");
    if(L<=0 || W<=0 || H<=0){ out.textContent = "Ingres√° las 3 medidas (en pulgadas)."; return; }
    const cft = (L * W * H) / 1728;
    const { mult, label } = getMultiplier();
    const total = cft * mult;
    out.innerHTML = `Tipo: <b>${label}</b><br>Total aproximado: <b>$${money(total)}</b>`;
  });

  document.getElementById("calcBtnMarVolClear").addEventListener("click", ()=>{
    ["calcL","calcW","calcH"].forEach(id => document.getElementById(id).value = "");
    document.getElementById("calcResV").textContent = "";
    document.getElementById("calcItemType").value = "mueble_10";
  });

  // Default: paso 2 oculto hasta elegir
  setMarMode("vol"); // ‚úÖ Default en Mar√≠timo: Volumen
});
</script>

</body>
</html>
