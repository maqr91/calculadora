<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>MIR CARGO NICARAGUA | Rastreo</title>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    :root{
      /* ‚úÖ Tus colores (royal + naranja pastel + whatsapp) */
      --azulClaro:#2563eb;
      --azulOscuro:#1d4ed8;

      --amarillo:#ffd1a6;
      --amarilloH:#ffbf85;

      --wa:#25D366;
      --waH:#1ebe57;

      --celesteTxt:#4db6ff;
      --celesteBg:rgba(77,182,255,.16);

      --texto:#0b1220;
      --muted:#526176;

      --bg:#f5f7fb;
      --card:#ffffff;
      --stroke:rgba(15,23,42,.10);

      --shadow: 0 18px 60px rgba(15, 23, 42, .08);
      --shadow2: 0 10px 30px rgba(15, 23, 42, .08);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--texto);
      background:
        radial-gradient(1200px 600px at 20% -10%, rgba(37,99,235,.18), transparent 60%),
        radial-gradient(900px 500px at 80% 0%, rgba(255,209,166,.28), transparent 55%),
        linear-gradient(#ffffff, var(--bg));
      font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Display","SF Pro Text", Roboto, Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* ======= TOP BAR (APPLE-LIKE) ======= */
    .topbar{
      position:sticky;
      top:0;
      z-index:50;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      background: rgba(255,255,255,.70);
      border-bottom: 1px solid var(--stroke);
    }
    .topbar-inner{
      max-width: 1100px;
      margin:0 auto;
      padding: 10px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      line-height:1.05;
      gap:2px;
      min-width: 180px;
    }
    .brand-title{
      font-weight:900;
      letter-spacing:.3px;
      font-size:14px;
    }
    .brand-sub{
      font-size:12px;
      color: var(--muted);
      font-weight:700;
    }

    .tabs{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .tab{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.65);
      color: var(--texto);
      padding: 9px 12px;
      border-radius: 999px;
      font-weight:850;
      cursor:pointer;
      font-size:13px;
      user-select:none;
      transition: transform .12s ease, background .12s ease;
      white-space:nowrap;
    }
    .tab:hover{ transform: translateY(-1px); background: rgba(255,255,255,.92); }
    .tab.active{
      background: linear-gradient(90deg, var(--azulClaro), var(--azulOscuro));
      color:#fff;
      border-color: rgba(29,78,216,.25);
      box-shadow: 0 10px 30px rgba(29,78,216,.18);
    }

    /* ======= HERO ======= */
    header.hero{
      position:relative;
      overflow:hidden;
      padding: 22px 14px 10px;
    }
    .hero-inner{
      max-width:1100px;
      margin:0 auto;
      padding: 18px;
      border-radius: 24px;
      background:
        linear-gradient(135deg, rgba(37,99,235,.16), rgba(255,209,166,.18)),
        radial-gradient(900px 300px at 20% 0%, rgba(37,99,235,.22), transparent 60%),
        radial-gradient(700px 260px at 90% 30%, rgba(255,209,166,.28), transparent 55%),
        rgba(255,255,255,.65);
      border: 1px solid rgba(15,23,42,.10);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
    }

    .hero-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    .hero-copy{
      text-align:left;
    }
    .hero-h1{
      margin:0;
      font-size: clamp(20px, 3.2vw, 34px);
      font-weight: 950;
      letter-spacing: -.4px;
    }
    .hero-h1 span{
      color: var(--azulOscuro);
    }
    .hero-p{
      margin:8px 0 0;
      color: var(--muted);
      font-weight:700;
      line-height:1.4;
      font-size: 13.5px;
      max-width: 740px;
    }

    .flags{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .flag{
      width:54px;
      height:36px;
      border-radius: 10px;
      object-fit:cover;
      box-shadow: 0 10px 18px rgba(0,0,0,.12);
      border: 1px solid rgba(255,255,255,.55);
    }

    /* ======= MAIN LAYOUT ======= */
    main{
      max-width:1100px;
      margin: 12px auto 60px;
      padding: 0 14px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
    }

    .card{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }
    .card-hd{
      padding: 14px 16px;
      border-bottom: 1px solid var(--stroke);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background: linear-gradient(180deg, rgba(245,247,251,.9), rgba(255,255,255,.65));
    }
    .card-title{
      margin:0;
      font-weight: 950;
      letter-spacing: -.2px;
      font-size: 15px;
    }
    .card-body{ padding: 14px 16px; }

    /* ======= Inputs / buttons ======= */
    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .field{
      flex:1;
      min-width: 220px;
      background:#fff;
      border: 1px solid var(--stroke);
      border-radius: 14px;
      padding: 11px 12px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .field input{
      border:none;
      outline:none;
      width:100%;
      font-size:15px;
      background:transparent;
    }

    .btn{
      border:none;
      cursor:pointer;
      font-weight: 900;
      border-radius: 14px;
      padding: 12px 14px;
      font-size: 14px;
      transition: transform .12s ease, filter .12s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{ transform: translateY(-1px); filter: brightness(1.02); }
    .btn.primary{
      background: linear-gradient(90deg, var(--amarillo), var(--amarilloH));
      color: var(--texto);
      border: 1px solid rgba(0,0,0,.08);
    }
    .btn.ghost{
      background: rgba(37,99,235,.10);
      color: var(--azulOscuro);
      border: 1px solid rgba(37,99,235,.20);
    }
    .btn.wa{
      background: var(--wa);
      color:#fff;
      border: 1px solid rgba(0,0,0,.10);
    }
    .btn.wa:hover{ background: var(--waH); }

    /* ======= Results ======= */
    .result{
      padding: 12px 16px;
      border-top: 1px solid var(--stroke);
    }
    .result + .result{ border-top: 1px solid var(--stroke); }
    .kvs{
      display:grid;
      grid-template-columns: 1fr;
      gap:6px;
      font-size: 13.5px;
      line-height:1.35;
    }
    .kv b{ font-weight: 900; }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 12.5px;
      background: var(--celesteBg);
      color: var(--celesteTxt);
      border: 1px solid rgba(77,182,255,.25);
    }

    .actions{
      margin-top:10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .actions .btn{ padding: 10px 12px; font-size: 13px; }

    .empty{
      display:none;
      padding: 14px 16px;
      color: var(--muted);
      font-weight: 800;
      text-align:center;
    }

    /* ======= CONTACTO ======= */
    .contact-grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media(min-width:820px){
      .contact-grid{ grid-template-columns: 1.2fr 1.2fr 1fr; }
    }
    .contact-card{
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      padding: 14px;
      background:
        linear-gradient(180deg, rgba(255,255,255,1), rgba(245,247,251,.65));
    }
    .contact-title{
      font-weight: 950;
      letter-spacing: -.2px;
      margin:0 0 8px;
      color: var(--azulOscuro);
      font-size: 14.5px;
    }
    .contact-line{
      margin: 3px 0;
      color: var(--texto);
      font-size: 13.5px;
      line-height: 1.35;
    }
    .contact-line small{ color: var(--muted); font-weight:800; }

    /* ======= CALCULADORA ======= */
    .calc-tabs{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:12px;
    }
    .calc-tab{
      flex:1;
      min-width: 160px;
      padding: 12px 12px;
      border: 1px solid var(--stroke);
      border-radius: 14px;
      background: rgba(255,255,255,.75);
      font-weight: 950;
      cursor:pointer;
      transition: transform .12s ease;
    }
    .calc-tab:hover{ transform: translateY(-1px); }
    .calc-tab.active{
      background: linear-gradient(90deg, var(--azulClaro), var(--azulOscuro));
      color:#fff;
      border-color: rgba(29,78,216,.22);
      box-shadow: 0 10px 25px rgba(29,78,216,.18);
    }
    .calc-panel{ display:none; }
    .calc-panel.active{ display:block; }

    .calc-subtabs{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin: 4px 0 12px;
    }
    .calc-subtab{
      flex:1;
      min-width: 170px;
      padding: 10px 12px;
      border: 1px solid var(--stroke);
      border-radius: 14px;
      background:#fff;
      font-weight: 950;
      cursor:pointer;
    }
    .calc-subtab.active{
      background: rgba(77,182,255,.14);
      border-color: rgba(77,182,255,.28);
    }

    .calc-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media(max-width:720px){
      .calc-grid{ grid-template-columns: 1fr; }
      .tabs{ justify-content:flex-start; }
      .brand{ min-width:unset; }
    }

    .label{
      font-weight: 900;
      font-size: 13px;
      margin: 0 0 6px;
      color: var(--muted);
    }
    .input{
      width:100%;
      border: 1px solid var(--stroke);
      border-radius: 14px;
      padding: 10px 12px;
      font-size: 14px;
      outline:none;
      background:#fff;
    }
    select.input{ appearance:auto; }

    .note{
      margin-top: 12px;
      padding: 12px 14px;
      border-radius: var(--radius);
      background: rgba(255,209,166,.25);
      border: 1px solid rgba(255,191,133,.45);
      color: #3b2b20;
      font-weight: 800;
      font-size: 12.8px;
      line-height: 1.4;
    }

    .calc-result{
      margin-top: 12px;
      padding: 12px 14px;
      border-radius: var(--radius);
      background: rgba(37,99,235,.08);
      border: 1px solid rgba(37,99,235,.14);
      font-weight: 900;
      min-height: 44px;
      display:flex;
      align-items:center;
    }

    /* ======= helpers ======= */
    .muted{ color: var(--muted); font-weight:800; }
    .hide{ display:none !important; }
  </style>
</head>

<body>

  <!-- ‚úÖ NAV MODERNA -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="brand-title">MIR CARGO NICARAGUA</div>
        <div class="brand-sub">Rastreo ‚Ä¢ Contacto ‚Ä¢ Calculadora ‚Ä¢ Citas</div>
      </div>

      <!-- ‚úÖ ORDEN: 1 Rastreo, 2 Contacto, 3 Calcular, 4 Agendar -->
      <div class="tabs" role="tablist" aria-label="Secciones">
        <button class="tab active" id="tabTrack" type="button">üì¶ Rastreo</button>
        <button class="tab" id="tabContact" type="button">‚òéÔ∏è Contacto</button>
        <button class="tab" id="tabCalc" type="button">üßÆ Calcular</button>
        <button class="tab" id="tabCita" type="button">üìÜ Agendar</button>
      </div>
    </div>
  </div>

  <!-- HERO -->
  <header class="hero">
    <div class="hero-inner">
      <div class="hero-top">
        <div class="hero-copy">
          <h1 class="hero-h1">Rastreo y env√≠os con <span>MiR</span></h1>
          <p class="hero-p">
            Consult√° tu carga, calcul√° costos y agend√° recolecci√≥n. Dise√±o limpio, r√°pido y adaptado a celular.
          </p>
        </div>

        <div class="flags" aria-hidden="true">
          <img class="flag" src="https://flagcdn.com/us.svg" alt="USA">
          <img class="flag" src="https://flagcdn.com/ni.svg" alt="Nicaragua">
        </div>
      </div>
    </div>
  </header>

  <main>

    <!-- ================== VIEW: RASTREO ================== -->
    <div id="viewTrack" class="grid">
      <section class="card">
        <div class="card-hd">
          <h2 class="card-title">üö¢ Rastreo Mar√≠timo</h2>
          <span class="muted">Busc√° por tracking</span>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="field">
              <input id="searchMaritimo" placeholder="N√∫mero de rastreo mar√≠timo" />
            </div>
            <button class="btn primary" onclick="searchTracking('Maritimo')">Buscar</button>
          </div>
        </div>
        <div id="resultsMaritimo"></div>
        <div id="emptyMaritimo" class="empty">‚ùå No encontramos ese n√∫mero.</div>
      </section>

      <section class="card">
        <div class="card-hd">
          <h2 class="card-title">‚úàÔ∏è Rastreo A√©reo</h2>
          <span class="muted">Busc√° por tracking</span>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="field">
              <input id="searchAereo" placeholder="N√∫mero de rastreo a√©reo" />
            </div>
            <button class="btn primary" onclick="searchTracking('Aereo')">Buscar</button>
          </div>
        </div>
        <div id="resultsAereo"></div>
        <div id="emptyAereo" class="empty">‚ùå No encontramos ese n√∫mero.</div>
      </section>

      <section class="card">
        <div class="card-hd">
          <h2 class="card-title">üõçÔ∏è Compras en l√≠nea</h2>
          <span class="muted">Por nombre o tracking</span>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="field">
              <input id="searchCompra" placeholder="Nombre o n√∫mero de tracking" />
            </div>
            <button class="btn primary" onclick="searchTracking('Compra')">Buscar</button>
          </div>
        </div>
        <div id="resultsCompra"></div>
        <div id="emptyCompra" class="empty">‚ö†Ô∏è Sin resultados.</div>
      </section>
    </div>

    <!-- ================== VIEW: CONTACTO ================== -->
    <div id="viewContact" class="grid" style="display:none;">
      <section class="card">
        <div class="card-hd">
          <h2 class="card-title">‚òéÔ∏è Contacto</h2>
          <span class="muted">Llamar ‚Ä¢ WhatsApp ‚Ä¢ Maps</span>
        </div>
        <div class="card-body">
          <div class="contact-grid">

            <div class="contact-card">
              <div class="contact-title">üìç Miami</div>
              <p class="contact-line">2035 W Flagler St, Miami, FL 33135.</p>
              <p class="contact-line"><small><b>Tel:</b> 305-631-0701 / 786-853-4444</small></p>
              <div class="actions">
                <a class="btn primary" href="tel:+13056310701" style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center;">üìû Llamar</a>
                <a class="btn wa" target="_blank" rel="noopener"
                   href="https://wa.me/13056310701?text=Hola,%20quiero%20que%20recojan%20una%20carga%20en%20la%20direcci%C3%B3n:%20_____________.%20Mi%20nombre%20es:%20____________.%20Mi%20tel%C3%A9fono%20es:%20____________."
                   style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center;">üí¨ WhatsApp</a>
                <a class="btn ghost" target="_blank" rel="noopener"
                   href="https://www.google.com/maps/search/?api=1&query=2035%20W%20Flagler%20St%20Miami%20FL%2033135"
                   style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center;">üìç Maps</a>
              </div>
            </div>

            <div class="contact-card">
              <div class="contact-title">üìç Managua</div>
              <p class="contact-line">Comtech Altamira, 1c arriba, 2c lago, 1c abajo. Casa #698.</p>
              <p class="contact-line"><small><b>Tel:</b> 8785-3842 / 8781-2066</small></p>
              <div class="actions">
                <a class="btn primary" href="tel:+50587853842" style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center;">üìû Llamar</a>
                <a class="btn ghost" target="_blank" rel="noopener"
                   href="https://maps.app.goo.gl/adbe3fBPA6vcGd8t5"
                   style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center;">üìç Maps</a>
              </div>
            </div>

            <div class="contact-card">
              <div class="contact-title">üìç Chinandega</div>
              <p class="contact-line">Esquina Suroeste de la Escuela El Rosario.</p>
              <p class="contact-line"><small><b>Tel:</b> 2346-8244 / 8899-9548</small></p>
              <div class="actions">
                <a class="btn primary" href="tel:+50523468244" style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center;">üìû Llamar</a>
                <a class="btn ghost" target="_blank" rel="noopener"
                   href="https://maps.app.goo.gl/PVczh5oMTN3kp53R6"
                   style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center;">üìç Maps</a>
              </div>
            </div>

          </div>
        </div>
      </section>
    </div>

    <!-- ================== VIEW: CALCULADORA ================== -->
    <div id="viewCalc" class="grid" style="display:none;">
      <section class="card">
        <div class="card-hd">
          <h2 class="card-title">üßÆ Calcular costo</h2>
          <span class="muted">A√©reo / Mar√≠timo</span>
        </div>

        <div class="card-body">
          <div class="calc-tabs" role="tablist" aria-label="Tipos de env√≠o">
            <button type="button" class="calc-tab active" id="calcTabA">‚úàÔ∏è A√©reo</button>
            <button type="button" class="calc-tab" id="calcTabM">üö¢ Mar√≠timo</button>
          </div>

          <!-- A√âREO -->
          <div class="calc-panel active" id="calcPanelA">
            <div class="calc-grid">
              <div>
                <div class="label">Libras (lbs)</div>
                <input class="input" type="number" id="calcAereoLbs" placeholder="Ej: 15" min="0" step="0.1" inputmode="decimal" />
              </div>
            </div>

            <div class="actions" style="margin-top:12px;">
              <button class="btn primary" type="button" id="calcBtnAereo">Calcular</button>
              <button class="btn ghost" type="button" id="calcBtnAereoClear">Limpiar</button>
            </div>

            <div class="calc-result" id="calcResA"></div>

            <div class="note">
              Regla: hasta 20 lbs = <b>$7.00/lb</b>. M√°s de 20 lbs = <b>$6.50/lb</b>.
            </div>
          </div>

          <!-- MAR√çTIMO -->
          <div class="calc-panel" id="calcPanelM">
            <div class="calc-subtabs" role="tablist" aria-label="Mar√≠timo por peso o volumen">
              <button type="button" class="calc-subtab active" id="calcSubTabPeso">‚öñÔ∏è Por peso</button>
              <button type="button" class="calc-subtab" id="calcSubTabVol">üì¶ Por volumen</button>
            </div>

            <!-- por peso -->
            <div class="calc-panel active" id="calcMarPesoPanel" style="display:block;">
              <div class="calc-grid">
                <div>
                  <div class="label">Libras (lbs)</div>
                  <input class="input" type="number" id="calcMarLbs" placeholder="Ej: 120" min="0" step="0.1" inputmode="decimal" />
                </div>
              </div>

              <div class="actions" style="margin-top:12px;">
                <button class="btn primary" type="button" id="calcBtnMarPeso">Calcular</button>
                <button class="btn ghost" type="button" id="calcBtnMarPesoClear">Limpiar</button>
              </div>

              <div class="calc-result" id="calcResM"></div>

              <div class="note">
                Reglas:
                <br>‚Ä¢ Hasta 100 lbs: <b>$2.05/lb</b>
                <br>‚Ä¢ M√°s de 100 lbs: <b>$2.00/lb</b>
                <br>‚Ä¢ M√°s de 300 lbs: <b>$1.90/lb</b>
                <br>‚Ä¢ M√°s de 500 lbs: <b>$1.80/lb</b>
              </div>
            </div>

            <!-- por volumen -->
            <div class="calc-panel" id="calcMarVolPanel" style="display:none;">
              <div class="calc-grid">
                <div>
                  <div class="label">Tipo de art√≠culo</div>
                  <select class="input" id="calcItemType">
                    <option value="mueble_10">Mueble</option>
                    <option value="ropa_30">Caja con ropa y art√≠culos varios</option>
                    <option value="refri_12">Electrodom√©stico (refrigeradora)</option>
                    <option value="lavadora_15">Electrodom√©stico (lavadora / secadora / cocina)</option>
                  </select>
                </div>

                <div>
                  <div class="label">Largo (in)</div>
                  <input class="input" type="number" id="calcL" placeholder="L" min="0" step="0.1" inputmode="decimal" />
                </div>
                <div>
                  <div class="label">Ancho (in)</div>
                  <input class="input" type="number" id="calcW" placeholder="W" min="0" step="0.1" inputmode="decimal" />
                </div>
                <div>
                  <div class="label">Alto (in)</div>
                  <input class="input" type="number" id="calcH" placeholder="H" min="0" step="0.1" inputmode="decimal" />
                </div>
              </div>

              <div class="actions" style="margin-top:12px;">
                <button class="btn primary" type="button" id="calcBtnMarVol">Calcular</button>
                <button class="btn ghost" type="button" id="calcBtnMarVolClear">Limpiar</button>
              </div>

              <div class="calc-result" id="calcResV"></div>

              <div class="note">
                El precio puede variar si las cantidades no est√°n correctas, el art√≠culo no est√° empacado,
                o si el peso es demasiado para el art√≠culo.
              </div>
            </div>

          </div>
        </div>
      </section>
    </div>

    <!-- ================== VIEW: AGENDAR ================== -->
    <div id="viewCita" class="grid" style="display:none;">
      <section class="card">
        <div class="card-hd">
          <h2 class="card-title">üìÜ Agendar recolecci√≥n</h2>
          <span class="muted">WhatsApp Miami</span>
        </div>
        <div class="card-body">
          <p class="muted" style="margin:0 0 10px;">
            Toc√° el bot√≥n y se abre WhatsApp con el mensaje listo para completar.
          </p>

          <div class="actions">
            <a class="btn wa" target="_blank" rel="noopener"
               href="https://wa.me/13056310701?text=Hola,%20quiero%20que%20recojan%20una%20carga%20en%20la%20direcci%C3%B3n:%20_____________.%20Mi%20nombre%20es:%20____________.%20Mi%20tel%C3%A9fono%20es:%20____________."
               style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center;">üí¨ Agendar por WhatsApp</a>

            <a class="btn primary" href="tel:+13056310701"
               style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center;">üìû Llamar</a>

            <a class="btn ghost" target="_blank" rel="noopener"
               href="https://www.google.com/maps/search/?api=1&query=2035%20W%20Flagler%20St%20Miami%20FL%2033135"
               style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center;">üìç Maps</a>
          </div>
        </div>
      </section>
    </div>

  </main>

  <script>
    /* ========================= RASTREO ========================= */

    const urls = {
      Maritimo:[
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vT2i-JMsQ4G2mXMfdEyihWcNeI8gzXDIWsSxOta60eGa-NgNDOshNojOB6mYxdHPOWkLKwGWZsdnfIL/pub?gid=0&single=true&output=csv",
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vT2i-JMsQ4G2mXMfdEyihWcNeI8gzXDIWsSxOta60eGa-NgNDOshNojOB6mYxdHPOWkLKwGWZsdnfIL/pub?gid=135469883&single=true&output=csv"
      ],
      Aereo:[
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vT2i-JMsQ4G2mXMfdEyihWcNeI8gzXDIWsSxOta60eGa-NgNDOshNojOB6mYxdHPOWkLKwGWZsdnfIL/pub?gid=1149417296&single=true&output=csv",
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vT2i-JMsQ4G2mXMfdEyihWcNeI8gzXDIWsSxOta60eGa-NgNDOshNojOB6mYxdHPOWkLKwGWZsdnfIL/pub?gid=1429832468&single=true&output=csv"
      ],
      Compra:
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vT2i-JMsQ4G2mXMfdEyihWcNeI8gzXDIWsSxOta60eGa-NgNDOshNojOB6mYxdHPOWkLKwGWZsdnfIL/pub?gid=532919355&single=true&output=csv"
    };

    function normalizeImageUrl(url){
      if(!url) return "";
      url = String(url).trim();

      let m = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
      if(m) return `https://drive.google.com/uc?export=view&id=${m[1]}`;

      m = url.match(/[?&]id=([a-zA-Z0-9_-]+)/);
      if(m) return `https://drive.google.com/uc?export=view&id=${m[1]}`;

      if(url.includes("googleusercontent")) return url;
      return url;
    }

    function safe(r,keys){
      for(const k of keys){ if(r && r[k]) return r[k]; }
      return "";
    }

    function parseDate(dateString){
      if(!dateString) return 0;
      const [datePart, timePart] = String(dateString).split(" ");
      if(!datePart || !timePart) return 0;
      const [day, month, year] = datePart.split("/");
      const [hour, minute, second] = timePart.split(":");
      return new Date(
        parseInt(year,10),
        parseInt(month,10)-1,
        parseInt(day,10),
        parseInt(hour,10),
        parseInt(minute,10),
        parseInt(second,10)
      ).getTime();
    }

    function renderTable(list,type){
      const container = document.getElementById(`results${type}`);
      const empty = document.getElementById(`empty${type}`);

      container.innerHTML = "";
      empty.style.display = "none";

      if(!list.length){
        empty.style.display = "block";
        return;
      }

      list.sort((a,b)=>{
        const da = parseDate(safe(a,["Fecha","FECHA"]));
        const db = parseDate(safe(b,["Fecha","FECHA"]));
        return db - da;
      });

      if(type === "Compra") list = list.slice(0,40);

      list.forEach(r=>{
        const fecha = safe(r,["Fecha","FECHA"]);
        const track = safe(r,["Tracking","Tracking #","Orden","ORDEN"]);
        const nombre = safe(r,["Nombre","Cliente","CLIENTE"]);
        const status = safe(r,["Status","STATUS"]);
        const agente = safe(r,["Agente","AGENTE","Usuario"]);

        const foto = normalizeImageUrl(safe(r,["Web url","Web URL"]));
        const firma = normalizeImageUrl(safe(r,["Firma url","Firma URL"]));

        const wrap = document.createElement("div");
        wrap.className = "result";

        let html = `<div class="kvs">`;
        html += `<div class="kv"><b>Fecha:</b> ${fecha}</div>`;
        html += `<div class="kv"><b>Tracking:</b> ${track}</div>`;

        if(type === "Compra"){
          html += `<div class="kv"><b>Nombre:</b> ${nombre}</div>`;
          html += `<div class="kv"><b>Agente:</b> ${agente}</div>`;
        } else {
          html += `<div class="kv"><b>Status:</b> <span class="pill">${status}</span></div>`;
          html += `<div class="kv"><b>Agente:</b> ${agente}</div>`;
        }
        html += `</div>`;

        html += `<div class="actions">`;
        if(foto){
          html += `<button class="btn ghost" onclick="window.open('${foto}','_blank')">üì∑ Ver foto</button>`;
        }
        if(type !== "Compra" && firma){
          html += `<button class="btn ghost" onclick="window.open('${firma}','_blank')">‚úçÔ∏è Ver firma</button>`;
        }
        html += `</div>`;

        wrap.innerHTML = html;
        container.appendChild(wrap);
      });
    }

    async function searchTracking(type){
      const input = document.getElementById(`search${type}`);
      const code = (input.value || "").trim().toLowerCase();
      if(!code) return;

      let data = [];
      const links = Array.isArray(urls[type]) ? urls[type] : [urls[type]];

      for(const link of links){
        await new Promise(resolve=>{
          Papa.parse(link + "&t=" + Date.now(), {
            download:true,
            header:true,
            skipEmptyLines:true,
            complete:res=>{
              data = data.concat(res.data || []);
              resolve();
            }
          });
        });
      }

      const filtered = data.filter(r=>{
        const track = (safe(r,["Tracking","Tracking #","Orden","ORDEN"]) || "").toLowerCase();
        const name  = (safe(r,["Nombre","Cliente"]) || "").toLowerCase();
        return track.includes(code) || name.includes(code);
      });

      renderTable(filtered, type);
    }

    ["Maritimo","Aereo","Compra"].forEach(t=>{
      document.getElementById(`search${t}`).addEventListener("keydown", e=>{
        if(e.key === "Enter") searchTracking(t);
      });
    });

    /* ========================= TABS PRINCIPALES ========================= */
    (function(){
      const tabTrack   = document.getElementById("tabTrack");
      const tabContact = document.getElementById("tabContact");
      const tabCalc    = document.getElementById("tabCalc");
      const tabCita    = document.getElementById("tabCita");

      const viewTrack   = document.getElementById("viewTrack");
      const viewContact = document.getElementById("viewContact");
      const viewCalc    = document.getElementById("viewCalc");
      const viewCita    = document.getElementById("viewCita");

      const tabs = [
        {btn: tabTrack,   view: viewTrack,   key:"track"},
        {btn: tabContact, view: viewContact, key:"contact"},
        {btn: tabCalc,    view: viewCalc,    key:"calc"},
        {btn: tabCita,    view: viewCita,    key:"cita"},
      ];

      function show(which){
        tabs.forEach(t=>{
          t.view.style.display = (t.key === which) ? "grid" : "none";
          t.btn.classList.toggle("active", t.key === which);
        });
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      tabTrack.addEventListener("click",   ()=>show("track"));
      tabContact.addEventListener("click", ()=>show("contact"));
      tabCalc.addEventListener("click",    ()=>show("calc"));
      tabCita.addEventListener("click",    ()=>show("cita"));

      // default: rastreo
      show("track");
    })();

    /* ========================= CALCULADORA ========================= */
    document.addEventListener("DOMContentLoaded", () => {
      const tabA = document.getElementById("calcTabA");
      const tabM = document.getElementById("calcTabM");
      const panelA = document.getElementById("calcPanelA");
      const panelM = document.getElementById("calcPanelM");

      function openCalc(which){
        [panelA, panelM].forEach(p => p.classList.remove("active"));
        [tabA, tabM].forEach(b => b.classList.remove("active"));
        if(which === "a"){ panelA.classList.add("active"); tabA.classList.add("active"); }
        if(which === "m"){ panelM.classList.add("active"); tabM.classList.add("active"); }
      }
      tabA.addEventListener("click", ()=>openCalc("a"));
      tabM.addEventListener("click", ()=>openCalc("m"));

      const subPeso = document.getElementById("calcSubTabPeso");
      const subVol  = document.getElementById("calcSubTabVol");
      const marPesoPanel = document.getElementById("calcMarPesoPanel");
      const marVolPanel  = document.getElementById("calcMarVolPanel");

      function openMarSub(which){
        subPeso.classList.toggle("active", which==="peso");
        subVol.classList.toggle("active", which==="vol");
        marPesoPanel.style.display = (which==="peso") ? "block" : "none";
        marVolPanel.style.display  = (which==="vol")  ? "block" : "none";
      }
      subPeso.addEventListener("click", ()=>openMarSub("peso"));
      subVol.addEventListener("click",  ()=>openMarSub("vol"));

      const money = (n) => (Number.isFinite(n) ? n.toFixed(2) : "0.00");
      const num = (id) => {
        const v = parseFloat(document.getElementById(id).value);
        return Number.isFinite(v) ? v : 0;
      };

      // A√©reo
      document.getElementById("calcBtnAereo").addEventListener("click", () => {
        const lbs = num("calcAereoLbs");
        const out = document.getElementById("calcResA");
        if(lbs <= 0){ out.textContent = "Ingres√° un peso v√°lido."; return; }
        const rate = (lbs > 20) ? 6.5 : 7;
        const total = lbs * rate;
        out.innerHTML = `Total aproximado: $${money(total)}`;
      });
      document.getElementById("calcBtnAereoClear").addEventListener("click", () => {
        document.getElementById("calcAereoLbs").value = "";
        document.getElementById("calcResA").textContent = "";
      });

      // Mar√≠timo por peso
      function rateMar(lbs){
        if(lbs > 500) return 1.8;
        if(lbs > 300) return 1.9;
        if(lbs > 100) return 2.0;
        return 2.05;
      }
      document.getElementById("calcBtnMarPeso").addEventListener("click", () => {
        const lbs = num("calcMarLbs");
        const out = document.getElementById("calcResM");
        if(lbs <= 0){ out.textContent = "Ingres√° un peso v√°lido."; return; }
        const total = lbs * rateMar(lbs);
        out.innerHTML = `Total aproximado: $${money(total)}`;
      });
      document.getElementById("calcBtnMarPesoClear").addEventListener("click", () => {
        document.getElementById("calcMarLbs").value = "";
        document.getElementById("calcResM").textContent = "";
      });

      // Mar√≠timo por volumen
      function getMultiplier(){
        const v = (document.getElementById("calcItemType").value || "");
        if(v === "mueble_10") return { mult: 10, label: "Mueble" };
        if(v === "ropa_30") return { mult: 30, label: "Caja con ropa y art√≠culos varios" };
        if(v === "refri_12") return { mult: 12, label: "Electrodom√©stico (refrigeradora)" };
        if(v === "lavadora_15") return { mult: 20, label: "Electrodom√©stico (lavadora/secadora/cocina)" };
        return { mult: 10, label: "Mueble" };
      }

      document.getElementById("calcBtnMarVol").addEventListener("click", () => {
        const L = num("calcL"), W = num("calcW"), H = num("calcH");
        const out = document.getElementById("calcResV");
        if(L<=0 || W<=0 || H<=0){ out.textContent = "Ingres√° las 3 medidas (en pulgadas)."; return; }

        const cft = (L * W * H) / 1728;
        const { mult, label } = getMultiplier();
        const total = cft * mult;

        out.innerHTML = `Tipo: ${label} ‚Äî Total aproximado: $${money(total)}`;
      });

      document.getElementById("calcBtnMarVolClear").addEventListener("click", () => {
        ["calcL","calcW","calcH"].forEach(id => document.getElementById(id).value = "");
        document.getElementById("calcResV").textContent = "";
        document.getElementById("calcItemType").value = "mueble_10";
      });

      // Defaults
      openCalc("a");
      openMarSub("peso");
    });
  </script>
</body>
</html>
